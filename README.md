# Телеграм-бот для поиска попутчиков

Этот Телеграм-бот облегчает совместные поездки, соединяя водителей и пассажиров. Он позволяет водителям создавать маршруты, пассажирам присоединяться к доступным маршрутам, а администраторам управлять пользователями и контролировать активность.

## Функции

- **Функциональность для водителей**:
  - Создание маршрута путем отправки текущего местоположения или ввода адреса.
  - Принятие запросов пассажиров на присоединение к маршруту.
  - Получение оптимизированных предложений маршрута с использованием Google Maps API.
  - Обмен живым местоположением для обновления расчетного времени прибытия (ETA) для пассажиров.

- **Функциональность для пассажиров**:
  - Присоединение к доступным маршрутам путем отправки текущего местоположения или ввода адреса.
  - Получение уведомлений о расчетном времени прибытия водителя.
  - Обращение в поддержку за помощью.

- **Функциональность для администраторов**:
  - Управление пользователями путем добавления или удаления их из белого списка.
  - Просмотр и управление всеми активными маршрутами.
  - Ответ на тикеты поддержки и изменение их статусов.
  - Рассылка сообщений всем пользователям.
  - Создание отчетов о тикетах и маршрутах.

## Содержание

- [Установка](#установка)
- [Конфигурация](#конфигурация)
- [Использование](#использование)
- [Команды](#команды)
- [Структура проекта](#структура-проекта)
- [Зависимости](#зависимости)
- [Лицензия](#лицензия)

## Установка

1. **Клонируйте репозиторий**:

   ```bash
   git clone https://github.com/yourusername/telegram-carpooling-bot.git
   cd telegram-carpooling-bot
   ```

2. **Создайте виртуальное окружение** (необязательно, но рекомендуется):

   ```bash
   python -m venv venv
   source venv/bin/activate  # В Windows используйте `venv\Scripts\activate`
   ```

3. **Установите необходимые пакеты**:

   ```bash
   pip install -r requirements.txt
   ```

4. **Настройте переменные окружения**:

   Создайте файл `.env` в корневой директории проекта и добавьте следующие переменные:

   ```env
   TELEGRAM_BOT_TOKEN=ВАШ_TELEGRAM_BOT_TOKEN
   GOOGLE_MAPS_API_KEY=ВАШ_GOOGLE_MAPS_API_KEY
   ```

   Замените `ВАШ_TELEGRAM_BOT_TOKEN` и `ВАШ_GOOGLE_MAPS_API_KEY` на ваши реальные токены.

   - **Telegram Bot Token**: Получите, создав нового бота через [BotFather](https://telegram.me/BotFather) в Телеграме.
   - **Google Maps API Key**: Сгенерируйте в [Google Cloud Console](https://console.cloud.google.com/). Убедитесь, что следующие API включены:
     - Geocoding API
     - Distance Matrix API
     - Directions API

## Конфигурация

- **Установите пароли ролей**:

  В файле `main.py` настройте словарь `ROLE_PASSWORDS`, чтобы установить пароли для разных ролей пользователей:

  ```python
  ROLE_PASSWORDS = {
      'администратор': 'ВашПарольАдминистратора',
      'водитель': 'ВашПарольВодителя',
      'пассажир': 'ВашПарольПассажира'
  }
  ```

- **Установите ID главного администратора**:

  Замените `MAIN_ADMIN_ID` на ваш Telegram ID:

  ```python
  MAIN_ADMIN_ID = ВАШ_TELEGRAM_ID
  ```

  Вы можете узнать свой Telegram ID, используя ботов, таких как [UserInfoBot](https://telegram.me/userinfobot).

- **Местоположение рабочего места**:

  Установите координаты пункта назначения (рабочего места):

  ```python
  workplace_location = "широта,долгота"
  ```

## Использование

Запустите бота, используя следующую команду:

```bash
python main.py
```

Бот начнет опрашивать обновления. Пользователи могут взаимодействовать с ботом через Телеграм.

## Команды

### Общие команды

- `/start` - Начать взаимодействие с ботом и выбрать роль.
- `/login` - Войти под другой ролью.

### Команды для водителей

- `/finish` - Завершить сбор пассажиров и получить оптимизированный маршрут.
- `/show_eta` - Показать расчетное время прибытия к каждому пассажиру.

### Команды для администраторов

- `/help` - Показать доступные команды администратора.
- `/list_routes` - Показать все текущие маршруты.
- `/broadcast` - Отправить сообщение всем пользователям.
- `/add_user` - Добавить пользователя в белый список.
- `/remove_user` - Удалить пользователя из белого списка.
- `/view_tickets` - Просмотреть тикеты поддержки.
- `/reports` - Создать отчет о тикетах и маршрутах.

## Структура проекта

- **`main.py`**: Главный скрипт, содержащий всю логику бота и обработчики.
- **`bot_activity.log`**: Файл журнала активности бота.
- **`whitelist.json`**: JSON-файл, хранящий ID пользователей в белом списке.
- **`tickets.json`**: JSON-файл, хранящий тикеты поддержки.
- **`encryption_key.key`**: Файл, хранящий ключ шифрования для конфиденциальных данных.

## Зависимости

- **Python 3.7+**
- **Библиотеки**:
  - `python-telegram-bot`: Библиотека Telegram Bot API.
  - `googlemaps`: Клиент для Google Maps API.
  - `python-dotenv`: Загрузка переменных окружения из `.env`.
  - `cryptography`: Для шифрования конфиденциальных данных.
  - `uuid`, `datetime`, `json`, `logging`: Стандартные библиотеки Python.

Установите зависимости, используя:

```bash
pip install -r requirements.txt
```

**Примечание**: Убедитесь, что вы используете версию `pip`, совместимую с вашей версией Python.

## Лицензия

Этот проект лицензирован по лицензии MIT. Подробности смотрите в файле [LICENSE](LICENSE).

---

**Отказ от ответственности**: Этот бот предназначен для образовательных целей. Убедитесь в соблюдении всех соответствующих законов и правил при развертывании и использовании этого бота.
